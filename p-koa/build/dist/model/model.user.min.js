"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,a){function o(e){try{i(n.next(e))}catch(e){a(e)}}function u(e){try{i(n.throw(e))}catch(e){a(e)}}function i(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,u)}i((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,s,a,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(s=n[2&a[0]?"return":a[0]?"throw":"next"])&&!(s=s.call(n,a[1])).done)return s;switch(n=0,s&&(a=[0,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var mysql_1=require("../mysql/mysql"),ModelUser=function(){function e(){}return e.prototype.findByTel=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t="select * from users where tel = "+e,[4,mysql_1.default.query(t)];case 1:return(r=n.sent()).length>0?[2,{code:1,message:"查询成功",data:r[0]}]:[2,{code:0,message:"用户不存在"}];case 2:return[2,{code:0,message:"登录出错",data:n.sent()}];case 3:return[2]}})})},e.prototype.insertOne=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,s;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),r="select 1 from users where tel = "+e+" limit 1",[4,mysql_1.default.query(r)];case 1:return a.sent().length>0?[2,{code:0,message:"手机号码已注册过"}]:[3,2];case 2:return n='insert into users (tel, password) values ("'+e+'", "'+t+'")',[4,mysql_1.default.query(n)];case 3:return[2,{code:(s=!!a.sent())?1:0,message:s?"注册成功":"注册失败"}];case 4:return[3,6];case 5:return[2,{code:0,message:"注册出错",data:a.sent()}];case 6:return[2]}})})},e.prototype.infoSave=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),r="update users set name='"+t.name+"',email='"+t.email+"',icon='"+t.icon+"' where tel="+t.tel+" limit 1",[4,mysql_1.default.query(r)];case 1:return!!s.sent()?e.redirect("/admin"):e.body="更新失败",[3,3];case 2:return n=s.sent(),e.body=n,[3,3];case 3:return[2]}})})},e}();exports.default=ModelUser;